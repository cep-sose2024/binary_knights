
<p align=center>
    <a href="https://github.com/cep-sose2024/binary_knights/" target="_blank"><img src="documentation/pictures/logoBlack.png" style="width:20%;"></a>
</p>

<p align="center">
  <a href="#installation">Installation</a>
  &nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;
  <a href="#compability">Compatibility</a>
  &nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;
  <a href="#secure-enclave">Secure Enclave</a>
</p>
A Rust-based wrapper for a crypto abstraction layer that accesses the iOS and macOS Secure Enclave processor.

This is a project in cooperation with j&s-soft GmbH and the Mannheim University of Applied Sciences.
#
#### Installation:

In Visual Studio Code, this repo must be opened and a MachO file must be created using the command 
```
  cargo build
```
must be created. 
This executable file is created in **"\target\debug "**. This cannot yet be executed due to missing entitlements.
We generate it as follows:

Any working Xcode project must be opened in Xcode and the bundle identifier must be set to **en.jssoft.BinaryKnights**.
The app must then be executed, whereby the entitlements are generated, and the storage location in Xcode can be selected by right-clicking on the app.
In this location, right-click on the .app and click on the second button to view the content.
Now open the MacOS folder in the terminal and paste this code:
```
codesign -d --entitlements - --xml "binaryknights" | plutil -convert xml1 -o - -
```
You will be shown the content of an XML file that you need to copy.
Now create the file **binaryknights.entitlements** in the folder **"\target\debug "** and paste the copied content there.

#

### Compability
All the information provided here is taken from Apple`s [Secure Enclave page](https://support.apple.com/guide/security/secure-enclave-sec59b0b31ff/web "Secure Enclave page from Apple"), where Apple also provides a clear overview. All information retrieved here is **as of 21.04.2024**. The "Supported" column indicates whether the iPhone or iMac is supported by our wrapper.
##### Iphone

| iPhone  | SoC| New SE enhancements of each significant SoC | Supported |
| --------- | --- | :-----:| ----: |
| 5s | A7 | not explicitly mentioned  | No
| 6, 6 Plus   | A8 |  not explicitly mentioned  | No
| 6s, 6s Plus and SE (1st gen)   |  A9  |  "[...] the UID is generated by the Secure Enclave TRNG during manufacturing and written to the fuses using a software process that runs entirely in the Secure Enclave. This process protects the UID from being visible outside the device during manufacturing and therefore isn’t available for access or storage by Apple or any of its suppliers. [...] the AES Engine also includes Dynamic Power Analysis (DPA) countermeasures. [...] the flash storage subsystem is on an isolated bus that’s granted access only to memory containing user data through the DMA crypto engine. "  | No
| 7, 7 Plus     | A10 Fusion  |  "[...] the Secure Enclave Boot ROM locks a hash of the [sepOS](https://support.apple.com/guide/security/aside/secc3e4f7a43/1/web/1 "sepOS") into a register dedicated to this purpose. The Public Key Accelerator uses this hash for operating-system-bound (OS-bound) keys. [...] the PKA supports OS-bound keys, also referred to as [Sealed Key Protection (SKP)](https://support.apple.com/guide/security/sealed-key-protection-skp-secdc7c6c88e/1/web/1 "Sealed Key Protection (SKP)"). These keys are generated using a combination of the device’s UID and the hash of the [sepOS](https://support.apple.com/guide/security/aside/secc3e4f7a43/1/web/1 "sepOS") running on the device. " | Yes
| 8, 8 Plus, X   | A11 Bionic | "[...] includes a memory-protected engine and encrypted memory with anti-replay capabilities, secure boot, a dedicated random number generator, and its own AES engine."  | Yes
| XR, XS, XS Max  | A12 Bionic|   "[...] the Secure Enclave is paired with a Secure Storage Component for entropy storage. The Secure Storage Component is itself designed with immutable ROM code, a hardware random number generator, a per-device unique cryptographic key, cryptography engines, and physical tamper detection. The Secure Enclave and Secure Storage Component communicate using an encrypted and authenticated protocol that provides exclusive access to the entropy." | Yes
| 11, 11 Pro, SE (2nd gen) | A13 Bionic | "[...] the Secure Enclave includes a Boot Monitor designed to ensure stronger integrity on the hash of the booted [sepOS](https://support.apple.com/guide/security/aside/secc3e4f7a43/1/web/1 "sepOS"). [...] the PKA’s [Public Key Accelerator] encryption implementations have been proved to be mathematically correct using formal verification techniques. [...] The hash is provided by the Secure Enclave Boot ROM, or by the Secure Enclave Boot Monitor [...]. These keys are also used to verify the sepOS version when making requests to certain Apple services and are also used to improve the security of passcode-protected data by helping to prevent access to keying material if critical changes are made to the system without user authorization." | Yes
| 12 Mini, 12, 12 Pro, 12 Pro Max    | A14 Bionic  | "[...] the Memory Protection Engine supports two ephemeral memory protection keys. The first is used for data private to the Secure Enclave, and the second is used for data shared with the Secure Neural Engine." | Yes
| 13, 13 Mini, 13 Pro, 13 Pro Max, SE (3rd gen), 14, 14 Plus      | A15 Bionic |    not explicitly mentioned| Yes
| 14 Pro, 14 Pro Max, 15, 15 Plus | A16 Bionic | not explicitly mentioned | Yes
| 15 Pro, 15 Pro Max    | A17 Pro  |   not explicitly mentioned | Yes


##### iMac and MacBook
The wrapper supports Macs with an Apple Silicon processor or Macs with an Intel processor that have a [T2 security chip](https://support.apple.com/en-us/103265 "T2 security chip").
The same also applies to MacBooks. In addition, the MacBook Pro 2016 and 2017, which have Touch Bar (these have a T1 security chip), are also supported.

# 


### Secure Enclave
> "The Secure Enclave is a dedicated secure subsystem integrated into Apple systems on chip (SoCs). The Secure Enclave is isolated from the main processor to provide an extra layer of security and is designed to keep sensitive user data secure even when the Application Processor kernel becomes compromised. It follows the same design principles as the SoC does—a boot ROM to establish a hardware root of trust, an AES engine for efficient and secure cryptographic operations, and protected memory. Although the Secure Enclave doesn’t include storage, it has a mechanism to store information securely on attached storage separate from the NAND flash storage that’s used by the Application Processor and operating system." ~ <a href="https://support.apple.com/guide/security/secure-enclave-sec59b0b31ff/web">Secure Enclave - Apple</a>
<p align=center> <a href="https://support.apple.com/guide/security/secure-enclave-sec59b0b31ff/web" target="_blank"><img src="https://help.apple.com/assets/627EBB4D4FDDD519030FB00A/627EBB504FDDD519030FB012/en_US/9302f62027e1966222080ef2731e45de.png" style="width:60%;"></a> </p>


### ~~References~~

~~This project is based on [ios-secure-enclave-sample](https://github.com/agestaun/ios-secure-enclave-sample) by [agestaun](https://github.com/agestaun), which is licensed under the MIT License.
We made several modifications to adapt the code for our project.~~



## License

[MIT](https://choosealicense.com/licenses/mit/)


